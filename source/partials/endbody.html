{{#if htmlWebpackPlugin.options.SERVICE_WORKER}}
    <script type="text/javascript">
        ('serviceWorker' in navigator) && (function(baseURL, hash) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                var scriptURL = baseURL + '?' + hash;
                var registration = registrations.find(function(r) {
                    return r.active && r.active.scriptURL.indexOf(baseURL) === 0 && scriptURL != r.active.scriptURL;
                });
                if (registration && localStorage.getItem('serviceWorkerHash') != hash) {
                    console.log('Service Worker was updated because hash changed.');
                    localStorage.setItem('serviceWorkerHash', hash);
                    registration.update();
                } else {
                    navigator.serviceWorker.register(scriptURL, {
                        scope: '/'
                    });
                    localStorage.setItem('serviceWorkerHash', hash);
                }
            });
        })(document.location.protocol + '//' + document.location.host + '/service-worker.js', '{{ htmlWebpackPlugin.options.serviceWorkerHash }}');
    </script>
{{/if}}
